<!DOCTYPE html>
<html lang="en" th:replace="~{base :: parent(~{::#content}, ~{:: title}, ~{:: script})}">
<head>
  <title th:text="${loggedInUser.firstName}+ ' - NexusFlow | All Contacts'"> </title>
</head>
<body>
<div id="content">
  <!-- Sidebar -->
  <div th:if="${loggedInUser}">
    <div th:replace="~{user/sidebar :: sidebar}"></div>
  </div>

  <!-- Main Content -->
  <div class="sm:pl-64 pt-20">
    <div class="px-4 md:px-8">
      <h1 class="text-3xl text-center font-semibold text-gray-900 dark:text-white">All Your Contacts</h1>
      <p class="text-center text-gray-600 dark:text-gray-400 mb-6">Manage, search, and connect with your saved contacts</p>

      <!-- Search + Export -->
      <div class="flex flex-col md:flex-row justify-between items-center bg-white dark:bg-gray-900 rounded-lg shadow p-4 mb-6">
        <form th:action="@{'/user/contacts/search'}" th:object="${contactSearchForm}" class="flex flex-wrap gap-4 items-center">
          <select th:field="*{field}" class="bg-gray-50 border w-xs border-gray-300 text-gray-900 text-sm rounded-lg p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
            <option value="" selected>Select Field</option>
            <option value="name">Name</option>
            <option value="email">Email</option>
            <option value="phone">Phone</option>
          </select>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">
              <i class="fa-solid fa-magnifying-glass"></i>
            </span>
            <input th:field="*{value}" type="text" placeholder="Search for contacts..." class="pl-10 p-2 text-sm border border-gray-300 rounded-lg w-72 bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
          </div>
          <button type="submit" class="px-4 py-2 bg-[#1A237E] hover:bg-blue-800 text-white rounded-lg shadow">Search</button>
        </form>
        <button onclick="exportContacts()" class="mt-4 md:mt-0 px-4 py-2 bg-[#1A237E] hover:bg-blue-800 text-white rounded-lg shadow">Export Contacts</button>
      </div>

      <!-- Message -->
      <div th:replace="~{message :: messagebox}"></div>

      <!-- Contacts Table -->
      <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
        <table id="contact-table" class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
          <thead class="text-xs uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
          <tr>
            <th class="px-6 py-3">Name</th>
            <th class="px-6 py-3">Phone</th>
            <th class="px-6 py-3">Links</th>
            <th class="px-6 py-3 text-center">Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="contact : ${pageContacts.getContent()}" class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
            <!-- Name + Email -->
            <td class="flex items-center px-6 py-4 whitespace-nowrap">
              <img th:src="@{${contact.picture}}" class="w-10 h-10 rounded-full" alt="Contact">
              <div class="ml-3">
                <div class="font-semibold text-gray-900 dark:text-white" th:text="${contact.name}">Name</div>
                <div class="text-gray-500 text-sm" th:text="${contact.email}">email@example.com</div>
              </div>
            </td>
            <!-- Phone -->
            <td class="px-6 py-4">
              <i class="fa-solid fa-phone text-gray-400 mr-1"></i>
              <span th:text="${contact.phoneNumber}">+91-1234567890</span>
            </td>
            <!-- Links -->
            <td class="px-6 py-4 flex space-x-3">
              <span th:if="${contact.favorite}" class="text-yellow-500"><i class="fa-solid fa-star"></i></span>
              <a th:href="@{${contact.linkedInLink}}" target="_blank" class="text-blue-600 hover:text-blue-800"><i class="fa-brands fa-linkedin-in"></i></a>
              <a th:href="@{${contact.websiteLink}}" target="_blank" class="text-gray-600 hover:text-gray-800"><i class="fa-solid fa-link"></i></a>
            </td>
            <!-- Actions -->
            <td class="px-6 py-4">
              <div class="flex items-center justify-center space-x-3">
                <button th:data-id="${contact.id}" th:onclick="deleteContact(this.getAttribute('data-id'))" class="w-8 h-8 flex items-center justify-center text-red-600 hover:text-red-800">
                  <i class="fa-solid fa-trash"></i>
                </button>
                <a th:href="@{'/user/contacts/view/'+${contact.id}}" class="w-8 h-8 flex items-center justify-center text-indigo-600 hover:text-indigo-800">
                  <i class="fa-solid fa-pen-to-square"></i>
                </a>
                <button th:data-id="${contact.id}" th:onclick="loadConatctData(this.getAttribute('data-id'))" class="w-8 h-8 flex items-center justify-center text-green-600 hover:text-green-800">
                  <i class="fa-solid fa-eye"></i>
                </button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination_container p-5 text-center">
        <nav aria-label="Page navigation">
          <ul class="inline-flex -space-x-px text-base h-10">
            <li th:unless="${pageContacts.first}">
              <a th:href="@{'/user/contacts?size='+${pageSize}+'&page='+${pageContacts.number-1}}" class="px-4 h-10 flex items-center justify-center border border-gray-300 rounded-l-lg bg-white hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-300">Previous</a>
            </li>
            <li th:each="index : ${#numbers.sequence(0, pageContacts.totalPages-1)}">
              <a th:href="@{'/user/contacts?size='+${pageSize}+'&page='+${index}}" th:classappend="${index==pageContacts.number ? 'bg-blue-200 dark:bg-blue-700' : 'bg-white dark:bg-gray-800'}" class="px-4 h-10 flex items-center justify-center border border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                <span th:text="${index+1}">1</span>
              </a>
            </li>
            <li th:unless="${pageContacts.last}">
              <a th:href="@{'/user/contacts?size='+${pageSize}+'&page='+${pageContacts.number+1}}" class="px-4 h-10 flex items-center justify-center border border-gray-300 rounded-r-lg bg-white hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-300">Next</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>

  <!-- Contact Modal -->
  <div th:replace="~{user/contact_modals :: contact}"></div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@linways/table-to-excel@1.0.4/dist/tableToExcel.min.js"></script>
<script th:src="@{'/js/contact.js'}"></script>
<script>
  function exportContacts() {
    TableToExcel.convert(document.getElementById("contact-table"), {
      name: "contacts.xlsx",
      sheet: { name: "CONTACTS" }
    });
  }
</script>
</body>
</html>
