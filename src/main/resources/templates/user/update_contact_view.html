<!DOCTYPE html>
<html lang="en" th:replace="~{base :: parent(~{::#content}, ~{:: title}, ~{:: script})}">
<head>
  <title th:text="${loggedInUser.name}+ ' - NexusFlow | Update Contact'"> </title>
</head>
<body>
<div id="content">
  <!-- Sidebar -->
  <div th:if="${loggedInUser}">
    <div th:replace="~{user/sidebar :: sidebar}"></div>
  </div>

  <!-- Main Content -->
  <div class="sm:pl-64 pt-20">
    <div class="max-w-3xl mx-auto">
      <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6 border border-gray-200 dark:border-gray-700">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Update Contact</h2>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">
          Modify your contact details. Updated info will be stored securely in NexusFlow.
        </p>

        <!-- message box -->
        <div th:replace="~{message :: messagebox}"></div>

        <!-- Form -->
        <form th:action="@{'/user/contacts/update/' + ${contactId}}"
              th:object="${contactForm}"
              method="post"
              enctype="multipart/form-data"
              class="space-y-6">

          <!-- Contact Name -->
          <div>
            <label class="block text-sm font-medium text-gray-900 dark:text-gray-200 mb-1">Contact Name</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                <i class="fa-solid fa-user"></i>
              </span>
              <input th:field="*{name}" type="text"
                     class="pl-10 w-full rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                     placeholder="Contact Name">
            </div>
            <span class="text-red-500 text-xs" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></span>
          </div>

          <!-- Email -->
          <div>
            <label class="block text-sm font-medium text-gray-900 dark:text-gray-200 mb-1">Email</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                <i class="fa-solid fa-envelope"></i>
              </span>
              <input th:field="*{email}" type="email"
                     class="pl-10 w-full rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                     placeholder="example@nexusflow.in">
            </div>
            <span class="text-red-500 text-xs" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></span>
          </div>

          <!-- Phone -->
          <div>
            <label class="block text-sm font-medium text-gray-900 dark:text-gray-200 mb-1">Phone</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                <i class="fa-solid fa-phone"></i>
              </span>
              <input th:field="*{phoneNumber}" type="text"
                     class="pl-10 w-full rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                     placeholder="+91 9876543210">
            </div>
            <span class="text-red-500 text-xs" th:if="${#fields.hasErrors('phoneNumber')}" th:errors="*{phoneNumber}"></span>
          </div>

          <!-- Address -->
          <div>
            <label class="block text-sm font-medium text-gray-900 dark:text-gray-200 mb-1">Address</label>
            <textarea th:field="*{address}" rows="3"
                      class="w-full rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                      placeholder="Enter full address..."></textarea>
          </div>

          <!-- Description -->
          <div>
            <label class="block text-sm font-medium text-gray-900 dark:text-gray-200 mb-1">Description</label>
            <textarea th:field="*{description}" rows="3"
                      class="w-full rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                      placeholder="Notes about this contact..."></textarea>
          </div>

          <!-- Social Links -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-900 dark:text-gray-200 mb-1">Website</label>
              <div class="relative">
                <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                  <i class="fa-solid fa-link"></i>
                </span>
                <input th:field="*{websiteLink}" type="text"
                       class="pl-10 w-full rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                       placeholder="www.nexusflow.in">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-900 dark:text-gray-200 mb-1">LinkedIn</label>
              <div class="relative">
                <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                  <i class="fa-brands fa-linkedin"></i>
                </span>
                <input th:field="*{linkedInLink}" type="text"
                       class="pl-10 w-full rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                       placeholder="LinkedIn profile link">
              </div>
            </div>
          </div>

          <!-- Contact Image -->
          <div>
            <label class="block text-sm font-medium text-gray-900 dark:text-gray-200 mb-1">Contact Image</label>
            <input th:field="*{contactImage}" type="file" id="image_file_input"
                   class="w-full text-sm text-gray-900 dark:text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700">
            <img id="upload_image_preview"
                 th:if="*{picture}"
                 th:src="*{picture}"
                 alt="Current Contact Image"
                 class="max-h-40 rounded-lg mt-4">
          </div>

          <!-- Hidden Contact ID -->
          <input type="hidden" name="contactId" th:value="${contactId}"/>

          <!-- Favorite -->
          <div class="flex items-center">
            <input th:field="*{favorite}" type="checkbox"
                   class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
            <label class="ml-2 block text-sm text-gray-900 dark:text-gray-200">Favorite?</label>
          </div>

          <!-- Actions -->
          <div class="flex justify-center gap-4">
            <button type="submit"
                    class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-500 text-sm font-medium">
              Update Contact
            </button>
            <button type="reset"
                    class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 text-sm font-medium">
              Reset
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script th:src="@{'/js/admin.js'}"></script>
<script>
  console.log("Hello from update_contact.html");
  document.getElementById('image_file_input')?.addEventListener('change', function (event) {
    const preview = document.getElementById('upload_image_preview');
    if (event.target.files.length > 0) {
      preview.src = URL.createObjectURL(event.target.files[0]);
      preview.classList.remove("hidden");
    }
  });
</script>
</body>
</html>
